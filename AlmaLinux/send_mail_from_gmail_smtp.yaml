# =======================================================================
# Version:          v1 - September 7,2020
# Author:           Weithenn Wang (weithenn at weithenn.org)
# Lab Environment:  Ansible AWX 17.1.0
# description:      Send mail from Gmail SMTP
# =======================================================================

---
- hosts: localhost
  gather_facts: no
  connection: local
  vars:
    datacenter: 'Datacenter'
    cluster: 'Cluster'
    folder_name: 'Windows-VMs'
    vm_name: 'WS2019'
    screenshot_path: '/tmp/WS2019.png'

  tasks:    
    - name: Sending an e-mail using Gmail SMTP servers
      mail:
        host: smtp.gmail.com
        port: 587
        username: "{{ Gmail_address }}"
        password: "{{ Gmail_password}}"
        to: Weithenn Wang <weithenn@weithenn.org>
        subject: Take a screenshot of the "{{ vm_name }}" virtual machine console
        body: System "{{ vm_name }}" has been successfully screenshotted.
        attach: "{{ screenshot_path }}"
      register: sending_email

    - name: Print sending an e-mail result
      debug:
        var: sending_email